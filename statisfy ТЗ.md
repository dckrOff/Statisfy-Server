# Statisfy - Поэтапное техническое задание для Cursor AI

## Общая информация о проекте

**Название:** Statisfy Server  
**Описание:** Серверная часть мобильного приложения для ежедневных интересных фактов, статистики и новостей  
**Платформа:** Spring Boot (Java)  
**База данных:** PostgreSQL  
**Цель:** Создание REST API с интеграцией ИИ для персонализации контента

---

## ЭТАП 1: Базовая инфраструктура и API пользователей
**Длительность:** 1-2 недели  
**Цель:** Создать базовое Spring Boot приложение с системой пользователей

### Задачи для Cursor AI:
1. **Настройка проекта:**
   - Создать Spring Boot проект с зависимостями: Web, Security, JPA, PostgreSQL
   - Настроить application.yml с конфигурацией БД
   - Добавить Docker Compose для PostgreSQL

2. **Модель данных пользователей:**
   - Entity класс User (id, username, email, password, role, createdAt)
   - Repository интерфейс UserRepository
   - Миграция базы данных (Flyway)

3. **Система аутентификации:**
   - JWT configuration
   - Spring Security настройки
   - AuthController с методами регистрации и входа
   - UserService для бизнес-логики

4. **Базовые API endpoints:**
   ```
   POST /api/auth/register - регистрация
   POST /api/auth/login - вход
   GET /api/user/profile - профиль пользователя
   PUT /api/user/profile - обновление профиля
   ```

### Критерии готовности:
- ✅ Приложение запускается
- ✅ База данных подключается
- ✅ Регистрация и вход работают
- ✅ JWT токены генерируются
- ✅ Защищенные endpoints требуют авторизации

---

## ЭТАП 2: Система контента (факты и статистика)
**Длительность:** 1-2 недели  
**Цель:** Добавить CRUD операции для фактов и статистики

### Задачи для Cursor AI:
1. **Модели контента:**
   - Entity Fact (id, title, content, category, source, isPublished, createdAt)
   - Entity Statistic (id, title, value, unit, category, source, date)
   - Entity Category (id, name, description)

2. **API для контента:**
   ```
   GET /api/facts - получить факты (с пагинацией)
   GET /api/facts/{id} - получить факт по ID
   POST /api/facts - создать факт (только админ)
   PUT /api/facts/{id} - обновить факт (только админ)
   DELETE /api/facts/{id} - удалить факт (только админ)
   
   GET /api/statistics - получить статистику
   GET /api/statistics/{id} - получить статистику по ID
   POST /api/statistics - создать статистику (только админ)
   
   GET /api/categories - получить категории
   ```

3. **Система ролей:**
   - Enum Role (USER, ADMIN)
   - Проверка прав доступа в контроллерах
   - AdminController для управления контентом

4. **Валидация и обработка ошибок:**
   - @Valid аннотации для DTO
   - GlobalExceptionHandler
   - Стандартизированные ответы API

### Критерии готовности:
- ✅ CRUD операции для фактов работают
- ✅ Система ролей функционирует
- ✅ Пагинация и фильтрация по категориям
- ✅ Валидация входных данных
- ✅ Обработка ошибок

---

## ЭТАП 3: Новостная система и внешние API
**Длительность:** 1-2 недели  
**Цель:** Интегрировать новостные API и создать систему сбора новостей

### Задачи для Cursor AI:
1. **Модель новостей:**
   - Entity News (id, title, summary, url, source, publishedAt, category, isRelevant)
   - NewsService для работы с новостями
   - NewsController для API

2. **Интеграция с внешними API:**
   - RestTemplate или WebClient для вызовов
   - NewsApiService для интеграции с NewsAPI
   - Scheduler для автоматического сбора новостей каждые 30 минут
   - Конфигурация API ключей в application.yml

3. **API endpoints для новостей:**
   ```
   GET /api/news - получить новости (с фильтрами)
   GET /api/news/{id} - получить новость по ID
   GET /api/news/relevant - получить релевантные новости
   ```

4. **Система кэширования:**
   - Spring Cache с простой конфигурацией
   - Кэширование популярных запросов на 15 минут

### Критерии готовности:
- ✅ Автоматический сбор новостей работает
- ✅ API для получения новостей функционирует
- ✅ Кэширование снижает нагрузку на внешние API
- ✅ Фильтрация новостей по категориям

---

## ЭТАП 4: Базовая ИИ интеграция
**Длительность:** 2-3 недели  
**Цель:** Добавить ИИ для генерации контента и анализа

### Задачи для Cursor AI:
1. **Интеграция с OpenAI API:**
   - OpenAI client configuration
   - AIService для взаимодействия с ИИ
   - Методы для генерации фактов и анализа новостей

2. **Генерация контента:**
   - Endpoint для генерации фактов на основе категории
   - Анализ релевантности новостей с помощью ИИ
   - Создание кратких описаний для статистики

3. **API endpoints для ИИ:**
   ```
   POST /api/ai/generate-fact - генерация факта по теме
   POST /api/ai/analyze-news - анализ релевантности новости
   GET /api/ai/daily-fact - факт дня (персонализированный)
   ```

4. **Система рекомендаций (базовая):**
   - UserPreference entity для хранения предпочтений
   - Простой алгоритм рекомендаций на основе категорий
   - API для установки предпочтений пользователя

### Критерии готовности:
- ✅ ИИ генерирует новые факты
- ✅ Анализ новостей на релевантность работает
- ✅ Базовые рекомендации по категориям
- ✅ Персонализированный контент для пользователей

---

## ЭТАП 5: Система уведомлений и планировщик
**Длительность:** 1-2 недели  
**Цель:** Добавить push-уведомления и регулярные задачи

### Задачи для Cursor AI:
1. **Push-уведомления:**
   - Интеграция с Firebase Cloud Messaging
   - NotificationService для отправки уведомлений
   - Модель DeviceToken для хранения токенов устройств

2. **Планировщик задач:**
   - @Scheduled методы для ежедневных задач
   - Отправка "факта дня" всем пользователям
   - Еженедельная сводка интересных новостей

3. **API для уведомлений:**
   ```
   POST /api/notifications/register-device - регистрация устройства
   POST /api/notifications/send - отправка уведомления (админ)
   GET /api/notifications/settings - настройки уведомлений
   PUT /api/notifications/settings - обновление настроек
   ```

4. **Настройки пользователя:**
   - NotificationSettings entity
   - Возможность отключения уведомлений
   - Выбор времени для получения ежедневного факта

### Критерии готовности:
- ✅ Push-уведомления отправляются
- ✅ Ежедневный "факт дня" работает
- ✅ Пользователи могут настроить уведомления
- ✅ Планировщик выполняет задачи по расписанию

---

## ЭТАП 6: Аналитика и мониторинг
**Длительность:** 1 неделя  
**Цель:** Добавить сбор аналитики и базовый мониторинг

### Задачи для Cursor AI:
1. **Система аналитики:**
   - UserActivity entity для отслеживания действий
   - AnalyticsService для сбора метрик
   - Interceptor для автоматического логирования API вызовов

2. **Метрики приложения:**
   - Использование Spring Boot Actuator
   - Кастомные метрики (количество активных пользователей, популярные категории)
   - Health checks для внешних сервисов

3. **API для аналитики:**
   ```
   GET /api/analytics/user-stats - статистика пользователя
   GET /api/analytics/popular-content - популярный контент
   GET /admin/analytics/dashboard - админская аналитика
   ```

4. **Логирование:**
   - Структурированное логирование важных событий
   - Логирование ошибок интеграций с внешними API
   - Ротация логов

### Критерии готовности:
- ✅ Сбор пользовательской активности
- ✅ Метрики приложения доступны
- ✅ Health checks работают
- ✅ Аналитическая информация доступна админам

---

## ЭТАП 7: Производительность и безопасность
**Длительность:** 1-2 недели  
**Цель:** Оптимизировать производительность и усилить безопасность

### Задачи для Cursor AI:
1. **Оптимизация производительности:**
   - Redis для кэширования сессий и популярных запросов
   - Database indexing для часто используемых запросов
   - Connection pooling настройки
   - Async обработка тяжелых операций (отправка уведомлений)

2. **Безопасность:**
   - Rate limiting с использованием Redis
   - Input validation и sanitization
   - CORS настройки
   - Secure headers (helmet-like functionality)

3. **API optimization:**
   - Pagination для всех списочных endpoints
   - ETags для кэширования на клиенте
   - Compression для ответов API

4. **Мониторинг производительности:**
   - Логирование медленных запросов
   - Метрики времени ответа
   - Monitoring для Redis и PostgreSQL connections

### Критерии готовности:
- ✅ API отвечает быстро (< 200ms для 95% запросов)
- ✅ Rate limiting защищает от злоупотреблений
- ✅ Кэширование снижает нагрузку на БД
- ✅ Безопасность усилена

---

## ЭТАП 8: Финальная полировка и документация
**Длительность:** 1 неделя  
**Цель:** Подготовить приложение к продакшену

### Задачи для Cursor AI:
1. **API документация:**
   - Swagger/OpenAPI 3 интеграция
   - Подробные описания всех endpoints
   - Примеры запросов и ответов

2. **Тестирование:**
   - Unit тесты для сервисов
   - Integration тесты для контроллеров
   - Тесты для ИИ интеграций

3. **Docker и deployment:**
   - Dockerfile для приложения
   - Docker Compose для полного стека (app + postgres + redis)
   - Переменные окружения для конфигурации

4. **Production готовность:**
   - Graceful shutdown
   - Health checks
   - Metrics endpoints
   - Error handling и recovery

### Критерии готовности:
- ✅ Полная API документация доступна
- ✅ Тесты покрывают критический функционал
- ✅ Приложение готово к deployment
- ✅ Мониторинг и логирование настроены

---

## Финальная архитектура

```
Statisfy Server
├── Controllers (REST API)
├── Services (Business Logic)
├── Repositories (Data Access)
├── External Integrations
│   ├── OpenAI API
│   ├── News API
│   └── Firebase CM
├── Scheduled Tasks
├── Security & Auth (JWT)
├── Caching (Redis)
└── Database (PostgreSQL)
```

## Основные технологии

- **Backend:** Spring Boot 3.x, Java 17+
- **Database:** PostgreSQL 14+, Redis
- **Security:** Spring Security, JWT
- **AI Integration:** OpenAI API
- **Notifications:** Firebase Cloud Messaging
- **Caching:** Redis, Spring Cache
- **Documentation:** Swagger/OpenAPI
- **Containerization:** Docker

## Порядок работы с Cursor AI

1. Для каждого этапа создавайте отдельную ветку в git
2. Четко указывайте Cursor AI какие файлы нужно создать/изменить
3. После каждого этапа тестируйте работоспособность
4. Используйте промпты вида: "Создай Spring Boot контроллер для управления фактами согласно ЭТАП 2"
5. Запрашивайте примеры тестов и документации
6. Убеждайтесь что миграции БД применяются корректно

## Примерные промпты для Cursor AI

**Этап 1:**
"Создай Spring Boot проект для Statisfy согласно ЭТАП 1. Нужны: User entity, JWT auth, basic REST endpoints для регистрации и входа. Используй PostgreSQL и Spring Security."

**Этап 2:**  
"Добавь в проект Statisfy систему контента из ЭТАП 2: Fact, Statistic, Category entities с CRUD API. Нужна система ролей USER/ADMIN и валидация данных."

И так далее для каждого этапа...

---

*Каждый этап должен завершаться полностью работоспособным приложением, которое можно запустить и протестировать.*